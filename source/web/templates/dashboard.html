{{> base.html}}
{{#content}}
<div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details">
                <h2>Welcome back, {{user_name}}!</h2>
                <p class="user-stats">
                    <span><i class="fas fa-file"></i> {{file_count}} files</span>
                    <span><i class="fas fa-hdd"></i> {{storage_used}} / {{storage_limit}}</span>
                    <span><i class="fas fa-share-alt"></i> {{share_count}} shares</span>
                </p>
            </div>
        </div>
        <div class="quick-actions">
            <button class="btn btn-primary" onclick="openUploadModal()">
                <i class="fas fa-upload"></i> Upload Files
            </button>
            <button class="btn btn-secondary" onclick="createFolder()">
                <i class="fas fa-folder-plus"></i> New Folder
            </button>
        </div>
    </div>

    <!-- Storage Usage Bar -->
    <div class="storage-bar">
        <div class="storage-label">Storage Usage</div>
        <div class="storage-progress">
            <div class="storage-fill" style="width: {{storage_percentage}}%"></div>
        </div>
        <div class="storage-text">{{storage_used}} of {{storage_limit}} used</div>
    </div>

    <!-- Navigation Breadcrumb -->
    <div class="breadcrumb">
        <a href="{{base_url}}/dashboard" class="breadcrumb-item">
            <i class="fas fa-home"></i> Home
        </a>
        {{#breadcrumb_items}}
        <span class="breadcrumb-separator">/</span>
        <a href="{{url}}" class="breadcrumb-item">{{name}}</a>
        {{/breadcrumb_items}}
    </div>

    <!-- File Management Area -->
    <div class="file-manager">
        <!-- Toolbar -->
        <div class="file-toolbar">
            <div class="view-controls">
                <button class="btn btn-icon active" id="gridView" onclick="setView('grid')">
                    <i class="fas fa-th"></i>
                </button>
                <button class="btn btn-icon" id="listView" onclick="setView('list')">
                    <i class="fas fa-list"></i>
                </button>
            </div>
            
            <div class="file-actions">
                <select id="sortBy" onchange="sortFiles(this.value)">
                    <option value="name">Sort by Name</option>
                    <option value="date">Sort by Date</option>
                    <option value="size">Sort by Size</option>
                    <option value="type">Sort by Type</option>
                </select>
                
                <button class="btn btn-icon" onclick="refreshFiles()">
                    <i class="fas fa-sync-alt"></i>
                </button>
                
                <button class="btn btn-icon" id="selectModeBtn" onclick="toggleSelectMode()">
                    <i class="fas fa-check-square"></i>
                </button>
            </div>
        </div>

        <!-- File Grid/List -->
        <div class="file-container" id="fileContainer">
            {{#files}}
            <div class="file-item {{type}}" data-id="{{id}}" data-type="{{type}}" data-name="{{name}}">
                <div class="file-checkbox">
                    <input type="checkbox" class="file-select" value="{{id}}">
                </div>
                
                <div class="file-icon">
                    {{#is_folder}}
                    <i class="fas fa-folder"></i>
                    {{/is_folder}}
                    {{^is_folder}}
                    {{#thumbnail}}
                    <img src="{{thumbnail}}" alt="{{name}}" class="file-thumbnail">
                    {{/thumbnail}}
                    {{^thumbnail}}
                    <i class="fas {{icon_class}}"></i>
                    {{/thumbnail}}
                    {{/is_folder}}
                </div>
                
                <div class="file-info">
                    <div class="file-name" title="{{name}}">{{name}}</div>
                    <div class="file-meta">
                        {{^is_folder}}<span class="file-size">{{formatted_size}}</span>{{/is_folder}}
                        <span class="file-date">{{formatted_date}}</span>
                    </div>
                </div>
                
                <div class="file-actions">
                    {{#is_folder}}
                    <button class="btn btn-icon" onclick="openFolder('{{id}}')" title="Open">
                        <i class="fas fa-folder-open"></i>
                    </button>
                    {{/is_folder}}
                    {{^is_folder}}
                    <button class="btn btn-icon" onclick="downloadFile('{{id}}')" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn btn-icon" onclick="shareFile('{{id}}')" title="Share">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    {{/is_folder}}
                    <button class="btn btn-icon" onclick="renameItem('{{id}}')" title="Rename">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-icon btn-danger" onclick="deleteItem('{{id}}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            {{/files}}
            
            {{^files}}
            <div class="empty-state">
                <i class="fas fa-folder-open"></i>
                <h3>This folder is empty</h3>
                <p>Upload files or create folders to get started</p>
                <button class="btn btn-primary" onclick="openUploadModal()">
                    <i class="fas fa-upload"></i> Upload Your First File
                </button>
            </div>
            {{/files}}
        </div>
    </div>

    <!-- Bulk Actions Bar (Hidden by default) -->
    <div class="bulk-actions" id="bulkActions" style="display: none;">
        <div class="bulk-info">
            <span id="selectedCount">0</span> items selected
        </div>
        <div class="bulk-buttons">
            <button class="btn btn-secondary" onclick="downloadSelected()">
                <i class="fas fa-download"></i> Download
            </button>
            <button class="btn btn-secondary" onclick="shareSelected()">
                <i class="fas fa-share-alt"></i> Share
            </button>
            <button class="btn btn-danger" onclick="deleteSelected()">
                <i class="fas fa-trash"></i> Delete
            </button>
            <button class="btn btn-outline" onclick="clearSelection()">Cancel</button>
        </div>
    </div>
</div>

<!-- Upload Modal -->
<div class="modal" id="uploadModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-upload"></i> Upload Files</h3>
            <button class="modal-close" onclick="closeUploadModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h4>Drag & Drop Files Here</h4>
                <p>or <button class="btn btn-link" onclick="document.getElementById('fileInput').click()">browse files</button></p>
                <input type="file" id="fileInput" multiple style="display: none;">
            </div>
            <div class="upload-queue" id="uploadQueue"></div>
        </div>
    </div>
</div>

<script>
// Dashboard JavaScript functionality
let currentView = 'grid';
let selectMode = false;
let currentFolder = '{{current_folder_id}}';

// File management functions
function setView(view) {
    currentView = view;
    document.getElementById('gridView').classList.toggle('active', view === 'grid');
    document.getElementById('listView').classList.toggle('active', view === 'list');
    document.getElementById('fileContainer').className = 'file-container view-' + view;
}

function toggleSelectMode() {
    selectMode = !selectMode;
    document.body.classList.toggle('select-mode', selectMode);
    document.getElementById('selectModeBtn').classList.toggle('active', selectMode);
    
    if (!selectMode) {
        clearSelection();
    }
}

function clearSelection() {
    document.querySelectorAll('.file-select').forEach(cb => cb.checked = false);
    updateBulkActions();
}

function updateBulkActions() {
    const selected = document.querySelectorAll('.file-select:checked');
    const bulkActions = document.getElementById('bulkActions');
    const selectedCount = document.getElementById('selectedCount');
    
    selectedCount.textContent = selected.length;
    bulkActions.style.display = selected.length > 0 ? 'flex' : 'none';
}

// File operations
function openFolder(folderId) {
    window.location.href = `{{base_url}}/dashboard?folder=${folderId}`;
}

function downloadFile(fileId) {
    window.open(`{{base_url}}/api/files/download/${fileId}`, '_blank');
}

function shareFile(fileId) {
    // Implementation for file sharing
    console.log('Share file:', fileId);
}

function renameItem(itemId) {
    const item = document.querySelector(`[data-id="${itemId}"]`);
    const currentName = item.dataset.name;
    const newName = prompt('Enter new name:', currentName);
    
    if (newName && newName !== currentName) {
        // Send rename request
        console.log('Rename item:', itemId, 'to:', newName);
    }
}

function deleteItem(itemId) {
    if (confirm('Are you sure you want to delete this item?')) {
        // Send delete request
        console.log('Delete item:', itemId);
    }
}

function refreshFiles() {
    window.location.reload();
}

function sortFiles(sortBy) {
    // Implementation for sorting
    console.log('Sort by:', sortBy);
}

// Upload functionality
function openUploadModal() {
    document.getElementById('uploadModal').style.display = 'flex';
}

function closeUploadModal() {
    document.getElementById('uploadModal').style.display = 'none';
}

function createFolder() {
    const name = prompt('Enter folder name:');
    if (name) {
        // Send create folder request
        console.log('Create folder:', name);
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // File selection handling
    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('file-select')) {
            updateBulkActions();
        }
    });
    
    // Upload area drag and drop
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('drag-over');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
    });
    
    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        handleFiles(e.dataTransfer.files);
    });
    
    document.getElementById('fileInput').addEventListener('change', function(e) {
        handleFiles(e.target.files);
    });
});

function handleFiles(files) {
    // Implementation for file upload handling
    console.log('Handle files:', files);
}
</script>
{{/content}}
